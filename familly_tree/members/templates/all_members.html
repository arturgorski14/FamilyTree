{% extends "master.html" %}

{% block title %}<h1>Members</h1>{% endblock %}

{% block content %}

<form method="get" action="">
    <label for="id_name">Name:</label>
    <input type="text" id="id_name" name="name" value="{{ request.GET.name|default:'' }}">

    <label for="id_sex">Sex:</label>
    <select id="id_sex" name="sex">
        {% for value, label in filter.form.sex.field.choices %}
        <option value="{{ value }}" {% if request.GET.sex == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>


    <label for="id_alive">Alive:</label>
    <select id="id_alive" name="alive">
        {% for value, label in filter.form.alive.field.choices %}
        <option value="{{ value }}" {% if request.GET.alive == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>

    <label for="id_children_count_min">Min Children:</label>
    <input type="number" id="id_children_count_min" name="children_count_min" value="{{ request.GET.children_count_min|default:'' }}">

    <label for="id_children_count_max">Max Children:</label>
    <input type="number" id="id_children_count_max" name="children_count_max" value="{{ request.GET.children_count_max|default:'' }}">

    <label for="id_age_min">Minimum Age:</label>
    <input type="number" id="id_age_min" name="age_min" value="{{ request.GET.age_min|default:'' }}">

    <label for="id_age_max">Maximum Age:</label>
    <input type="number" id="id_age_max" name="age_max" value="{{ request.GET.age_max|default:'' }}">

    <button type="submit">Filter</button>
    <a href="{% url 'members:members' %}">Clear</a> <!-- Clear Filters -->
</form>

{% include "add_button.html" %}

<table class="members-table">
  <thead>
    <tr>
      <th>Id</th>
      <th>Name</th>
      <th>Family Name</th>
      <th>Spouse</th>
      <th>Sex</th>
      <th>Age</th>
      <th>Alive?</th>
      <th>Number of children</th>
      <th>Father</th>
      <th>Mother</th>
    </tr>
  </thead>
  <tbody>
    {% for member in all_members %}
    <tr class="{% if member.alive == 'Yes' %}member-alive{% else %}member-dead{% endif %}">
      <td>
        {{ member.id }}
      </td>
      <td>
        <a href="{% url 'members:details' member.id %}">
          {{ member }}
        </a>
      </td>
      <td>
        {{ member.family_name }}
      </td>
      <td>

        {% if member.current_spouse %}
            <a href="{% url 'members:details' member.current_spouse.pk %}" >{{ member.current_spouse }}</a>
        {% else %}
            -
        {% endif %}
      </td>
      <td>
        {% if member.sex == 'm' %}
          Male
        {% else %}
          Female
        {% endif %}
      </td>
      <td>
        {{ member.age|default_if_none:"-" }}
      </td>
      <td>
        {{ member.alive }}
      </td>
      <td>
        {% if member.children.count %}
          {{ member.children.count }}
        {% else %}
          -
        {% endif %}
      </td>
      <td>
        {% if member.father_id %}
            <a href="{% url 'members:details' member.father_id %}" >{{ member.father }}</a>
        {% else %}
            -
        {% endif %}
      </td>
      <td>
        {% if member.mother_id %}
            <a href="{% url 'members:details' member.mother_id %}" >{{ member.mother }}</a>
        {% else %}
            -
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="2">No members</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% include "add_button.html" %}

{% endblock %}
